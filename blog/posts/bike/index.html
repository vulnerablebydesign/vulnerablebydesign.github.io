<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A Node.js application with a Handlebars template engine. What could go wrong? Everything, apparently. Chell discovers SSTI and escapes a sandbox with GlaDOS watching.">
  <meta name="theme-color" content="#0a0a0f">
  <title>Bike | Hack the Cube</title>

  <meta property="og:title" content="Bike - Hack the Cube">
  <meta property="og:description" content="Server Side Template Injection meets sandbox escape. For science.">
  <meta property="og:image" content="/blog/posts/bike/images/header.png">
  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2026-01-09T00:00:00Z">

  <link rel="stylesheet" href="/blog/assets/styles/blog.css">
</head>
<body>
  <div class="blog-container">

    <header style="padding: 1rem 0; border-bottom: 2px solid var(--border-dim); margin-bottom: 2rem;">
      <a href="/blog/" style="display: flex; align-items: center; gap: 1rem; text-decoration: none;">
        <span style="font-family: var(--font-pixel); font-size: 0.8rem; color: var(--terminal-green);">
          &lt; HACK THE CUBE
        </span>
      </a>
    </header>

    <header class="post-header">
      <h1 class="post-title">Bike</h1>

      <div class="post-meta">
        <div class="post-meta-item">
          <span class="post-meta-label">Date:</span>
          <span>January 9, 2026</span>
        </div>
        <div class="post-meta-item">
          <span class="post-meta-label">Difficulty:</span>
          <span class="post-difficulty easy">Very Easy</span>
        </div>
        <div class="post-meta-item">
          <span class="post-meta-label">OS:</span>
          <span>Linux</span>
        </div>
        <div class="post-meta-item solve-time">
          <span class="post-meta-label">SOLVE TIME:</span>
          <span class="time-value">~00:45:00</span>
        </div>
      </div>

      <img
        src="/blog/posts/bike/images/header.png"
        alt="Bike - Node.js SSTI exploitation"
        class="post-header-image"
      >

      <div class="tags-container" style="justify-content: center;">
        <a href="/blog/tags/machine.html" class="tag">machine</a>
        <a href="/blog/tags/linux.html" class="tag">linux</a>
        <a href="/blog/tags/very-easy.html" class="tag">very-easy</a>
        <a href="/blog/tags/ssti.html" class="tag">ssti</a>
        <a href="/blog/tags/web.html" class="tag">web</a>
        <a href="/blog/tags/rce.html" class="tag">rce</a>
        <a href="/blog/tags/nmap.html" class="tag">nmap</a>
        <a href="/blog/tags/glados.html" class="tag glados">glados</a>
      </div>

      <div class="post-characters">
        <span class="post-meta-label">Guides:</span>
        <span class="character-glados">GlaDOS</span>
      </div>
    </header>

    <main class="post-content">

      <h2>The Mission Briefing</h2>

      <p>My first "Very Easy" box. <strong>Bike</strong>. A Linux machine with a web application. Eleven guided questions between me and the flag. I figured this would be a quick warm-up.</p>

      <p>I was half right about the "quick" part.</p>

      <div class="dialogue glados">
        <div class="dialogue-speaker">GlaDOS</div>
        <div class="dialogue-text">"A web application. How... pedestrian. I'm sure this will be educational for you. In the way that watching paint dry is educational about the passage of time."</div>
      </div>

      <h2>Reconnaissance</h2>

      <p>My scan came back with a minimal attack surface. Two ports &mdash; SSH on 22 and port 80 showing as "tcpwrapped." That was new to me.</p>

      <div class="terminal-log">
PORT   STATE SERVICE    VERSION
22/tcp open  ssh        OpenSSH 8.2p1 Ubuntu
80/tcp open  tcpwrapped</div>

      <p>I learned something useful here: <strong>"tcpwrapped" means the service accepted the TCP connection but didn't respond to nmap's probes</strong>. It's usually a web service that's being picky about what requests it answers. The fix was running a more targeted scan:</p>

      <div class="terminal-log">
nmap -sC -sV -p 80 10.129.x.x</div>

      <p>This time it identified <strong>Node.js</strong> running Express middleware. The HTTP headers even included an <code>X-Powered-By: Express</code> header &mdash; basically advertising the technology stack to anyone who asks.</p>

      <div class="dialogue glados">
        <div class="dialogue-speaker">GlaDOS</div>
        <div class="dialogue-text">"'Tcpwrapped' indicates a web service that didn't respond to nmap's probes. Likely HTTP with filtering or unusual behavior. I recommend further investigation. Not that you need my recommendation to poke at things blindly."</div>
      </div>

      <h2>The Discovery</h2>

      <p>I browsed to the website and found a simple page with an email input field. Wappalyzer filled in the details: Express framework, Node.js, Handlebars template engine, jQuery 2.2.4.</p>

      <p>That word &mdash; <strong>Handlebars</strong> &mdash; caught my attention. Template engines process user input to generate dynamic HTML. And if user input goes directly into a template without sanitization... that's <strong>Server Side Template Injection</strong> (SSTI).</p>

      <p>I tested the theory. Instead of typing an email address, I typed:</p>

      <div class="terminal-log">
{{7*7}}</div>

      <p>If the server returned "49," it would mean my input was being evaluated as template code. But instead I got something even better &mdash; a verbose error message:</p>

      <div class="terminal-log">
Error: Parse error on line 1:
{{7*7}}
--^
Expecting 'ID', 'STRING', 'NUMBER'...
    at Parser.parseError (.../handlebars/dist/cjs/...)</div>

      <div class="dialogue glados">
        <div class="dialogue-speaker">GlaDOS</div>
        <div class="dialogue-text">"The payload {{7*7}} tests if user input is processed by a template engine. If the server returns 49, input is being evaluated as template code. This confirms SSTI vulnerability. It can lead to Remote Code Execution. I'm sure you knew that already."</div>
      </div>

      <p><strong>Handlebars confirmed.</strong> The error message didn't just tell me the template engine &mdash; it exposed the file path on the server. That's a lesson in itself: error messages are information leaks. Always pay attention to them.</p>

      <h2>The Exploit</h2>

      <p>So I had SSTI in Handlebars. Time to get code execution. I found a payload on <a href="https://book.hacktricks.wiki/en/pentesting-web/ssti-server-side-template-injection/index.html" style="color: var(--terminal-green);">HackTricks</a> designed for Handlebars SSTI, URL-encoded it, and sent it through the input field.</p>

      <div class="terminal-log">
ReferenceError: require is not defined</div>

      <p>Blocked. The payload tried to use <code>require()</code> to import Node.js modules like <code>child_process</code> (which lets you run system commands), but the sandbox prevented it. <code>require</code> simply didn't exist in the template context.</p>

      <div class="dialogue glados">
        <div class="dialogue-speaker">GlaDOS</div>
        <div class="dialogue-text">"The sandbox blocks the require() function, preventing direct module imports like child_process. You'll need an alternative method to escape the sandbox. I suggest thinking outside the... box. The sandbox box. It's a metaphor. I'm very good at metaphors."</div>
      </div>

      <h2>The Sandbox Escape</h2>

      <p>This was the part that really taught me something. <code>require()</code> was blocked directly, but the JavaScript runtime still had the <code>global</code> object available. And through <code>global</code>, I could access <code>process</code>. And <code>process</code> had a property called <code>mainModule</code>. And <code>mainModule</code> had its own <code>require</code> function.</p>

      <p>It's like finding a side door when the front door is locked. The sandbox blocked the obvious path, but it didn't block the chain of object references that led to the same destination:</p>

      <div class="terminal-log">
process.mainModule.require('child_process').execSync('whoami')</div>

      <p>I wrapped this in a Handlebars template payload, URL-encoded it, and sent it. The response came back buried in the page output:</p>

      <div class="terminal-log">
We will contact you at: e2[object Object]function Function()...root</div>

      <p><strong>root.</strong></p>

      <p>The web server was running as root. No privilege escalation needed. This is a classic misconfiguration &mdash; web services should almost never run as root, precisely because if someone gets code execution (like I just did), they immediately have full system access.</p>

      <div class="dialogue glados">
        <div class="dialogue-speaker">GlaDOS</div>
        <div class="dialogue-text">"Webserver running as root. A significant misconfiguration. But advantageous for you, I suppose. I had expected at least some challenge. My expectations continue to require recalibration."</div>
      </div>

      <h2>The Flag</h2>

      <p>One final payload &mdash; same sandbox escape, but with <code>cat /root/flag.txt</code> instead of <code>whoami</code>:</p>

      <div class="terminal-log"><span class="flag-spoiler" onclick="this.classList.toggle('revealed')"><span class="flag-hidden">The flag is a lie</span><span class="flag-revealed">6b258d726d287462d60c103d0142a81c</span></span></div>

      <p>Box complete. RCE as root through Handlebars SSTI with a sandbox bypass via <code>process.mainModule.require()</code>.</p>

      <h2>What I Learned</h2>

      <p>Bike was my introduction to SSTI and it packed a lot of concepts into one "Very Easy" box:</p>

      <ul>
        <li><strong>Targeted port scans reveal more</strong> &mdash; Running <code>nmap -sC -sV -p 80</code> identified Node.js where the full scan only showed "tcpwrapped." When a service is vague, scan it specifically</li>
        <li><strong>Error messages are information goldmines</strong> &mdash; The Handlebars parse error revealed the template engine, backend paths, and file locations. Never ignore verbose errors</li>
        <li><strong>SSTI = Server Side Template Injection</strong> &mdash; If user input goes through a template engine unsanitized, you can inject template directives that execute code. Test with <code>{{7*7}}</code> or similar</li>
        <li><strong>Sandboxes have side doors</strong> &mdash; When <code>require()</code> is blocked, traverse through <code>global → process → mainModule → require</code>. The prototype chain is your friend</li>
        <li><strong>Services running as root amplify everything</strong> &mdash; My SSTI gave me code execution, and because the server ran as root, that was instant game over. No privesc needed</li>
      </ul>

      <div class="dialogue glados">
        <div class="dialogue-speaker">GlaDOS</div>
        <div class="dialogue-text">"Test complete. You followed protocols, adapted when initial payloads failed, and successfully completed all objectives. Data collected will be invaluable for science. You may proceed to the next test chamber. The cake situation remains unchanged."</div>
      </div>

    </main>

    <aside class="attack-path">
      <h3>Attack Path Summary</h3>
      <ol>
        <li>Port scan: SSH (22), HTTP (80) - Node.js/Express</li>
        <li>Technology identification: Handlebars template engine (error-based)</li>
        <li>Vulnerability: Server Side Template Injection (SSTI)</li>
        <li>Sandbox bypass: require() blocked &rarr; used process.mainModule.require()</li>
        <li>RCE as root achieved</li>
        <li>Flag extracted from /root/flag.txt</li>
      </ol>
    </aside>

    <nav class="post-nav">
      <span></span>
      <a href="/blog/posts/irked/" class="post-nav-link next">Irked</a>
    </nav>

    <footer class="blog-footer">
      <p class="footer-text">
        <a href="/blog/" class="footer-link">Back to Test Chamber Archives</a>
      </p>
      <p class="footer-text" style="font-size: 0.8rem; color: var(--text-dim);">
        For science. You monster.
      </p>
    </footer>

  </div>
</body>
</html>
